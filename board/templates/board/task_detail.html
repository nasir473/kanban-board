{% extends 'base.html' %}
{% block content %}
<div class="create-task-section" style="margin: 2.5rem auto 0 auto;">
    <h2>Edit Task</h2>
    <form method="post">
        {% csrf_token %}
        <input type="text" name="short_description" value="{{ task.short_description }}" placeholder="Short description" required />
        <textarea name="description" placeholder="Description" required>{{ task.description }}</textarea>
        <div class="form-row" style="display:flex; flex-direction:column; gap:0.5rem;">
            <div class="form-priority-row">
                <label for="id_priority">Priority</label>
                <select name="priority" id="id_priority" class="form-priority-select">
                    <option value="low" {% if task.priority == 'low' %}selected{% endif %}>Low</option>
                    <option value="normal" {% if task.priority == 'normal' %}selected{% endif %}>Normal</option>
                    <option value="high" {% if task.priority == 'high' %}selected{% endif %}>High</option>
                </select>
            </div>
            <div class="form-checkbox-row">
                <label for="id_is_working">
                    <input type="checkbox" name="is_working" id="id_is_working" {% if task.is_working %}checked{% endif %}>
                    <span>Someone is working</span>
                </label>
            </div>
        </div>
        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
            <button type="submit" name="save">Save</button>
            <button type="button" onclick="confirmDelete()" style="background: #d32f2f; color: white;">Delete Task</button>
        </div>
    </form>
    <div style="margin-top:2rem;width:100%;">
        <h3 style="color: var(--coffee-brown);">Remarks / Comments</h3>
        <form method="post">
            {% csrf_token %}
            <textarea name="comments" placeholder="Add remarks or comments here..." style="width:100%;min-height:60px;border-radius:1rem;">{{ task.comments }}</textarea>
            <button type="submit" style="margin-top:0.5rem;">Save Comments</button>
        </form>
    </div>
</div>

<script>
function confirmDelete() {
    if (confirm('Are you sure you want to delete this task? This action cannot be undone.')) {
        // Create a form to submit the delete request
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{% url "delete_task" task.id %}';
        
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'csrfmiddlewaretoken';
        csrfInput.value = csrfToken;
        form.appendChild(csrfInput);
        
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}
